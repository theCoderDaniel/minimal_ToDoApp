<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>To-Do</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#665cff">
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link href="https://fonts.googleapis.com/css?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #665cff;
      --bg: #f6faff;
      --card: #fff;
      --radius: 21px;
    }
    html, body {
      margin: 0; padding: 0;
      background: var(--bg);
      font-family: 'Inter', sans-serif;
      font-size: 20px;
    }
    body, .container { min-height: 100vh; }
    .container {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
      justify-content: flex-start;
      padding: 0;
      box-sizing: border-box;
    }
    h1 {
      margin: 42px 0 28px 0;
      text-align: center;
      color: var(--primary);
      font-weight: 700;
      font-size: 2rem;
      letter-spacing: -1px;
    }
    .todo-box {
      width: 100%;
      max-width: 99vw;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 6px 34px #b1b2ca13;
      padding: 32px 5vw 22px 5vw;
      display: flex; flex-direction: column; gap: 25px;
      box-sizing: border-box;
    }
    @media (max-width:480px){
      h1{font-size:1.6rem;}
      .todo-box { padding: 24px 2vw 14px 2vw; }
    }

    .todo-form {
      display: flex; gap: 18px;
      background: #f7f8fe;
      border-radius: 17px;
      padding: 12px 12px 12px 18px;
      align-items: center;
      border: 1.4px solid #ebe8fc;
      box-shadow: 0 2px 15px #c7befa10 inset;
      box-sizing: border-box;
    }
    .todo-form input {
      flex: 1 1 auto;
      font-size: 1.17em;
      padding: 17px 7px 17px 2px;
      border: none;
      background: none;
      outline: none;
      color: #232357;
      border-radius: 7px;
    }
    .todo-form input::placeholder {color:#b2b6d6;}
    .todo-form button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 60px; height: 60px;
      min-width: 60px; min-height: 60px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: background .12s;
      box-shadow: 0 1.5px 10px #b1b2ca25;
      outline: none;
      padding: 0;
      user-select: none;
      margin-right: 2px;
    }
    .todo-form button:active {background: #4931f4;}
    .todos-list {
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      gap: 18px; width: 100%;
    }
    .todo-card {
      background: #f7f8fe;
      border-radius: 16px;
      box-shadow: 0 1.5px 8px #bbb9f10e;
      padding: 19px 13px 19px 19px;
      display: flex; align-items: center; gap: 14px;
      font-size: 1.13em;
      font-weight: 500;
    }
    .todo-card.done {
      opacity: .43;
      text-decoration: line-through;
      color: #b0bbe4;
      font-weight:400;
    }
    .todo-close {
      background: none; border: none;
      color: #cdcafa;
      border-radius: 100%;
      font-size: 1.21em;
      width: 42px; height: 42px;
      display: flex; align-items: center; justify-content: center;
      margin-left: auto;
      cursor: pointer;
      transition: color .14s, background .13s;
    }
    .todo-close:active, .todo-close:hover { color: #ef5350; background: #fbe6e3;}
    .todo-check {
      margin-right: 9px; margin-left: -1px;
      appearance: none;
      width: 28px; height: 28px;
      border-radius: 50%;
      border: 2.4px solid var(--primary);
      background: #fcfcfe;
      cursor: pointer;
      position: relative;
      transition: border .15s, background .13s;
      flex-shrink: 0;
    }
    .todo-check:checked { background: var(--primary);}
    .todo-check:checked:after {
      content: '';
      width: 13px; height: 13px;
      display: block;
      background: #fff;
      border-radius: 50%;
      position: absolute; top: 6.5px; left: 6.5px;
    }
    .empty {
      text-align: center;
      color: #bfc7d8;
      font-size: 1.13em;
      font-weight: 600;
      margin:16px 0 12px 0;
    }
    .todo-label {
      flex: 1;
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: pointer;
      padding: 0 6px;
      font-weight: 500;
    }
    /* Modal minimalistisch */
    .todo-detail-modal {
      position:fixed;inset:0;
      background:rgba(0,0,0,0.08);
      display:flex;align-items:center;justify-content:center;
      z-index:1000;
    }
    .todo-detail-modal-inner {
      background: #fff;
      padding: 20px 19px 14px 19px;
      border-radius: 13px;
      max-width:94vw;
      font-size:1.06em;
      min-width:120px;
      max-height:60vh;
      overflow:auto;text-align:left;
      box-shadow:0 3px 32px #665cff17;
    }
    .todo-detail-modal-inner button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 9px 28px;
      font-size:1.06em;
      font-weight:600;
      margin: 18px auto 0 auto;
      display: block;
      outline:none;
      cursor:pointer;
      box-shadow:none;
      transition: background .14s;
    }
    .todo-detail-modal-inner button:active { background:#5147e4; }
  </style>
</head>
<body>
<div class="container">
  <h1>To-Do</h1>
  <div class="todo-box">
    <form class="todo-form" id="todoForm" autocomplete="off">
      <input type="text" id="todoInput" placeholder="Neues To-Do..." maxlength="45" required>
      <button type="submit" title="HinzufÃ¼gen" aria-label="To-Do hinzufÃ¼gen">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
          <path d="M12 6v12M6 12h12" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      </button>
    </form>
    <div class="todos-list" id="todos"></div>
  </div>
</div>
<script>
const STORAGE_KEY = "todos1";
function getTodos() { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
function saveTodos(todos){ localStorage.setItem(STORAGE_KEY,JSON.stringify(todos)); }
function truncateText(str, n) {
  if(str.length <= n) return str.replace(/</g,"&lt;");
  return str.slice(0,n-1).replace(/</g,"&lt;") + 'â€¦';
}
function showDetails(text) {
  document.querySelector('.todo-detail-modal')?.remove();
  const modal = document.createElement('div');
  modal.className = 'todo-detail-modal';
  modal.innerHTML = `<div class="todo-detail-modal-inner">
    ${text.replace(/</g,"&lt;")}
    <button onclick="this.closest('.todo-detail-modal').remove()">SchlieÃŸen</button>
  </div>`;
  modal.onclick = e => { if(e.target === modal) modal.remove(); };
  document.body.appendChild(modal);
}
function renderTodos(){
  const todos = getTodos();
  const wrap = document.getElementById('todos');
  wrap.innerHTML = '';
  if(!todos.length) wrap.innerHTML = `<div class="empty">Keine To-Dos ðŸŽ‰</div>`;
  todos.forEach((t,i) => {
    const card = document.createElement('div');
    card.className = "todo-card" + (t.done ? " done" : "");
    card.innerHTML = `
      <input type="checkbox" class="todo-check" ${t.done?'checked':''} id="tdc${i}">
      <span class="todo-label" tabindex="0" title="${t.text.replace(/"/g,"&quot;")}">${truncateText(t.text, 30)}</span>
      <button class="todo-close" title="LÃ¶schen" data-i="${i}">&times;</button>
    `;
    wrap.appendChild(card);
    card.querySelector('.todo-check').onchange = function(){
      const todos=getTodos();todos[i].done=!todos[i].done;saveTodos(todos);renderTodos();
    }
    card.querySelector('.todo-close').onclick = function(){
      const todos = getTodos(); todos.splice(i,1); saveTodos(todos); renderTodos(); 
    }
    card.querySelector('.todo-label').onclick = () => showDetails(t.text);
  });
}
document.getElementById('todoForm').onsubmit = function(e){
  e.preventDefault();
  const inp=document.getElementById('todoInput');
  const txt = inp.value.trim();
  if(!txt) return;
  const todos = getTodos();
  todos.unshift({text:txt,done:false});
  saveTodos(todos);
  inp.value=""; inp.blur();
  renderTodos();
};
renderTodos();

// PWA: Service Worker registrieren
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('service-worker.js');
  });
}
</script>
</body>
</html>

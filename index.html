<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>To-Do</title>

  <!-- PWA Manifest + Meta -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#665cff">
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="To-Do">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- Sanfter, moderner Google Font (Inter wÃ¤re mein Tipp, wirkt budget-mÃ¤ÃŸig!) -->
  <link href="https://fonts.googleapis.com/css?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #665cff;
      --primary-light: #b6b2fc;
      --bg: #fbfbfe;
      --card: #fff;
      --card-radius: 20px;
      --shadow: 0 4px 24px 0 #665cff0d;
    }
    html,body {
      margin: 0; padding: 0;
      font-family: 'Inter', 'Manrope', Arial, sans-serif;
      background: var(--bg);
      color: #232357;
      font-size: 18px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    body, .container { min-height: 100vh; }
    .container {
      max-width: 420px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      justify-content: flex-start;
      padding: 0 0 40px 0;
    }
    h1 {
      margin: 44px 0 32px 0;
      text-align: center;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: -1.3px;
      color: var(--primary);
    }
    .todo-box {
      width: 96vw; max-width: 390px; margin: 0 auto;
      background: var(--card);
      border-radius: var(--card-radius);
      box-shadow: var(--shadow);
      padding: 32px 14px 22px 14px;
      display: flex; flex-direction: column; gap: 22px;
    }
    .todo-form {
      display: flex; gap:14px;
      background: #f5f5ff;
      border-radius: 15px;
      padding: 7px 9px 7px 17px;
      border: 1.4px solid #ebe8fc;
      align-items: center;
      box-shadow:0 2px 9px #665cff0a inset;
    }
    .todo-form input {
      flex: 1 1 auto;
      font-size: 1.12em;
      padding: 16px 7px 16px 2px;
      border: none;
      border-radius: 7px;
      background: none;
      outline: none;
      color: #292964;
      font-family: inherit;
      letter-spacing:-.2px;
    }
    .todo-form input::placeholder { color:#b2b6d6;}
    .todo-form button {
      background: var(--primary);
      color: #fff;
      border-radius: 13px;
      width: 54px; height: 54px;
      min-width:54px; min-height:54px;
      border: none;
      font-size: 1.85em;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700;
      box-shadow: 0 2px 10px #a09fff1b;
      cursor: pointer;
      transition: background .15s;
      outline: none;
      user-select: none;
      touch-action: manipulation;
      line-height: 0.6;
    }
    .todo-form button:active {background:#5147e4;}
    .todos-list {
      margin:0;padding:0;
      display:flex;flex-direction:column;gap:19px;width:100%;
    }
    .todo-card {
      background: #f9f9ff;
      border-radius: 14px;
      box-shadow: 0 1.5px 8px #3e32f111;
      padding: 19px 13px 19px 17px;
      min-height:50px;
      display:flex; align-items:center; gap:11px;
      font-size:1.1em;
      font-weight:500;
      color:#232357;
    }
    .todo-card.done {
      opacity: .51;
      text-decoration: line-through;
      color: #b7adf4;
      font-weight:400;
    }
    .todo-close {
      background: none; border: none;
      color: #cdcafa;
      border-radius: 100%;
      font-size: 1.4em;
      width: 38px; height: 38px;
      display: flex; align-items: center; justify-content: center;
      margin-left: auto;
      cursor: pointer;
      transition: color .14s, background .13s;
    }
    .todo-close:active, .todo-close:hover { color: #ef5350; background: #fbe6e3;}
    .todo-check {
      margin-right: 6px; margin-left: -1px;
      appearance: none;
      width: 25px; height: 25px;
      border-radius: 50%;
      border: 2.2px solid var(--primary);
      background: #fcfcfe;
      cursor: pointer;
      position: relative;
      transition: border .15s, background .13s;
      flex-shrink:0;
    }
    .todo-check:checked { background: var(--primary);}
    .todo-check:checked:after {
      content: '';
      width: 11px; height: 11px;
      display: block;
      background: #fff;
      border-radius: 50%;
      position: absolute; top: 5px; left: 5px;
    }
    .empty {
      text-align: center;
      color: #bfc7d8;
      font-size:1.11em;
      font-weight:600;
      margin:16px 0 12px 0;
    }
    .todo-label {
      flex: 1;
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: pointer;
      padding: 0 5px;
      font-weight: 500;
    }
    /* Modal minimalistisch */
    .todo-detail-modal {
      position:fixed;inset:0;
      background:rgba(0,0,0,0.08);
      display:flex;align-items:center;justify-content:center;
      z-index:1000;
    }
    .todo-detail-modal-inner {
      background: #fff;
      padding: 19px 16px 12px 16px;
      border-radius: 12px;
      max-width:94vw;
      font-size:1.03em;
      min-width:100px;
      max-height:60vh;
      overflow:auto;text-align:left;
      box-shadow:0 3px 32px #665cff17;
    }
    .todo-detail-modal-inner button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 8px 22px;
      font-size:1em;
      font-weight:600;
      margin: 15px auto 0 auto;
      display: block;
      outline:none;
      cursor:pointer;
      box-shadow:none;
      transition: background .14s;
    }
    .todo-detail-modal-inner button:active { background:#5147e4;}
    @media (max-width:470px){
      .container {padding-bottom:0;}
      .todo-box{max-width:99vw; padding-left:2vw;padding-right:2vw;}
      .todo-form input { font-size:1.14em;padding:15px 5px 15px 3px;}
      .todo-form button {font-size:2.04em;}
      h1{font-size:2rem;margin-bottom:28px;}
    }
  </style>
</head>
<body>
<div class="container">
  <h1>To-Do</h1>
  <div class="todo-box">
    <form class="todo-form" id="todoForm" autocomplete="off">
      <input type="text" id="todoInput" placeholder="Neues To-Do..." maxlength="45" required>
      <button type="submit" title="HinzufÃ¼gen">+</button>
    </form>
    <div class="todos-list" id="todos"></div>
  </div>
</div>
<script>
const STORAGE_KEY = "todos1";
function getTodos() { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
function saveTodos(todos){ localStorage.setItem(STORAGE_KEY,JSON.stringify(todos)); }
function truncateText(str, n) {
  if(str.length <= n) return str.replace(/</g,"&lt;");
  return str.slice(0,n-1).replace(/</g,"&lt;") + 'â€¦';
}
function showDetails(text) {
  document.querySelector('.todo-detail-modal')?.remove();
  const modal = document.createElement('div');
  modal.className = 'todo-detail-modal';
  modal.innerHTML = `<div class="todo-detail-modal-inner">
    ${text.replace(/</g,"&lt;")}
    <button onclick="this.closest('.todo-detail-modal').remove()">SchlieÃŸen</button>
  </div>`;
  modal.onclick = e => { if(e.target === modal) modal.remove(); };
  document.body.appendChild(modal);
}
function renderTodos(){
  const todos = getTodos();
  const wrap = document.getElementById('todos');
  wrap.innerHTML = '';
  if(!todos.length) wrap.innerHTML = `<div class="empty">Keine To-Dos ðŸŽ‰</div>`;
  todos.forEach((t,i) => {
    const card = document.createElement('div');
    card.className = "todo-card" + (t.done ? " done" : "");
    card.innerHTML = `
      <input type="checkbox" class="todo-check" ${t.done?'checked':''} id="tdc${i}">
      <span class="todo-label" tabindex="0" title="${t.text.replace(/"/g,"&quot;")}">${truncateText(t.text, 30)}</span>
      <button class="todo-close" title="LÃ¶schen" data-i="${i}">&times;</button>
    `;
    wrap.appendChild(card);
    card.querySelector('.todo-check').onchange = function(){
      const todos=getTodos();todos[i].done=!todos[i].done;saveTodos(todos);renderTodos();
    }
    card.querySelector('.todo-close').onclick = function(){
      const todos = getTodos(); todos.splice(i,1); saveTodos(todos); renderTodos(); 
    }
    card.querySelector('.todo-label').onclick = () => showDetails(t.text);
  });
}
document.getElementById('todoForm').onsubmit = function(e){
  e.preventDefault();
  const inp=document.getElementById('todoInput');
  const txt = inp.value.trim();
  if(!txt) return;
  const todos = getTodos();
  todos.unshift({text:txt,done:false});
  saveTodos(todos);
  inp.value=""; inp.blur();
  renderTodos();
};
renderTodos();

// PWA: Service Worker registrieren
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('service-worker.js');
  });
}
</script>
</body>
</html>
